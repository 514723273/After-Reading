## 第 1 章　作用域是什么

### 1.1 编译原理

传统编译步骤：
1. 分词/词法分析（Tokenizing/Lexing）：这个过程会将由字符组成的字符串分解成（对编程语言来说）有意义的代码块，这些代码块被称为**词法单元**（token）。
2. 解析/语法分析（Parsing）：这个过程是将词法单元流（数组）转换成一个由元素逐级嵌套所组成的代表了程序语法结构的树。这个树被称为“抽象语法树”（Abstract Syntax Tree，**AST**）。
3. 代码生成：将AST转换为**可执行代码**的过程称被称为代码生成。这个过程与语言、目标平台等息息相关。

JavaScript的编译过程不是发生在构建之前的，大部分情况下编译发生在代码**执行前**的几微秒（甚至更短！）的时间内。

### 1.2 结合作用域

作用域是一套规则，用于确定在何处以及如何查找变量（标识符）。如果查找的目的是对变量进行**赋值**，那么就会使用**LHS**查询；如果目的是**获取**变量的值，就会使用**RHS**查询（记忆：Retrieve His Source Value）。

JavaScript引擎首先会在代码执行前对其进行编译，在这个过程中，像`var a = 2`这样的声明会被分解成两个独立的步骤：
1. 首先，`var a`在其作用域中声明新变量。这会在最开始的阶段，也就是代码执行前进行。
2. 接下来，`a = 2`会查询（LHS查询）变量a并对其进行赋值。

LHS和RHS查询都会在当前执行作用域中开始，找不到就向上找。

不成功的`RHS`引用会导致抛出ReferenceError异常。不成功的`LHS`引用会导致自动隐式地创建一个全局变量（非严格模式下），该变量使用LHS引用的目标作为标识符，或者抛出ReferenceError异常（严格模式下）。