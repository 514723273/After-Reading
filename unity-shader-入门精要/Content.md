# 第四章 学习 Shader 所需的数学基础

## 4.2 笛卡尔坐标系

### 4.2.2　三维笛卡儿坐标系

在三维笛卡儿坐标系中，我们需要定义3个坐标轴（**基矢量**）和一个原点。

通常情况下，这 3 个坐标轴之间是互相垂直的，**且长度为1**，这样的基矢量被称为**标准正交基** ，但这并不是必须的。例如，在一些坐标系中坐标轴之间互相垂直但长度不为1，这样的基矢量被称为**正交基**。

### 4.2.3　左手坐标系和右手坐标系

二维笛卡儿坐标系可以通过旋转翻转使坐标系变为相同。这种意义上来说，所有的二维笛卡儿坐标系都是等价的。

但对于三维笛卡儿坐标系，靠这种旋转有时**并不能使两个不同朝向的坐标系重合**。

### 4.2.4　Unity使用的坐标系

在**模型**空间和**世界**空间中，Unity使用的是**左**手坐标系。 

对于**观察**空间（以摄像机为原点的坐标系）来说，Unity使用的是**右**手坐标系。摄像机的前向是 **z 轴的负方向**。也就是说，z 轴坐标的减少意味着场景深度的增加。

（模型空间在不发生改变的情况下，与世界空间坐标轴方向相同；观察空间的 z 轴方向和模型空间的 z 轴方向相反。）

## 4.3　点和矢量

### 4.3.2　矢量运算

1. 矢量和标量乘法/除法
2. 矢量的加法和减法
3. 矢量的模
4. 单位矢量
5. 矢量的**点积**(dot product):**投影**：得到长度不限得矢量在平行于的一条直线上的投影。（乘以该直线的单位矢量）(a·b=|a||b|cosx)
6. 矢量的**叉积**(cross product):对两个矢量进行叉积的结果会得到一个同时垂直于这两个矢量的新矢量。（计算垂直于一个平面、三角形的矢量）(|axb|=|a||b|sinx)（方向一定，左右手坐标系只会影响我们的视觉）

## 4.4 矩阵

### 4.4.3　矩阵运算

1. 矩阵和标量的乘法
2. 矩阵和矩阵的乘法

### 4.4.4　特殊的矩阵

1. 方块矩阵
2. 单位矩阵（任何矩阵和它相乘的结果都还是原来的矩阵（$MI = IM = M$
3. 转置矩阵（$(AB)^T =B^TA^T$
4. 逆矩阵（$MM^{−1} = M^{−1}M = I$（$(AB)^{−1}=B^{−1}A^{−1}$（如果一个矩阵的行列式不为 0，那么它就是可逆的。
5. 正交矩阵（$MM^T=M^TM=I$（如果一个方阵和它的转置矩阵的乘积是单位矩阵（转置矩阵和逆矩阵是一样（一个正交矩阵的行和列之间分别构成了一组标准正交基。

## 4.5 矩阵的几何意义：变换

### 4.5.1　什么是变换

线性变换：旋转、缩放、错切、镜像、正交投影

平移变换：既不满足标量乘法，也不满足矢量加法。

仿射变换就是合并 线性变换 和 平移变换 的变换类型。

### 4.5.2　齐次坐标

从三维坐标（点）转换成齐次坐标是把其 w 分量设为 1 ，

而对于方向矢量来说，需要把其 w 分量设为 0 。

### 4.5.3　分解基础变换矩阵

我们把表示纯平移、纯旋转和纯缩放的变换矩阵叫做基础变换矩阵。

$$
\begin{bmatrix}
M_{3\times3} & t_{3\times1} \\
0_{1\times3} & 1    \\
\end{bmatrix}
$$

- 左上角的矩阵 $M_{3\times3}$ 用于表示旋转和缩放，
- 右上角 $t_{3\times1}$ 用于表示平移，
- 左下角 $0_{1\times3}$ 是零矩阵，即0 $_{1\times3}$ =[0 0 0]，
- 右下角的元素就是标量1。

### 4.5.4　平移矩阵

可以使用矩阵乘法来表示对**一个点**进行平移变换。

$$
 \begin{bmatrix}
   1 & 0 & 0 & t_x \\
   0 & 1 & 0 & t_y \\
   0 & 0 & 1 & t_z \\
   0 & 0 & 0 & 1 
  \end{bmatrix}
 \begin{bmatrix}
    x \\
    y \\
    z \\
    1
  \end{bmatrix}
=
\begin{bmatrix}
    x + t_x \\
    y + t_y \\
    z + t_z \\
    1
\end{bmatrix}
$$

有趣的是，如果我们对一个**方向矢量**进行平移变换，结果如下：

$$
 \begin{bmatrix}
   1 & 0 & 0 & t_x \\
   0 & 1 & 0 & t_y \\
   0 & 0 & 1 & t_z \\
   0 & 0 & 0 & 1 
  \end{bmatrix}
 \begin{bmatrix}
    x \\
    y \\
    z \\
    0
  \end{bmatrix}
=
\begin{bmatrix}
    x \\
    y \\
    z \\
    0
\end{bmatrix}
$$

可以发现，平移变换不会对方向矢量产生任何影响。（因为矢量没有位置属性）

### 4.5.5　缩放矩阵


$$
 \begin{bmatrix}
   k_x & 0 & 0 & 0 \\
   0 & k_y & 0 & 0 \\
   0 & 0 & k_z & 0 \\
   0 & 0 & 0 & 1 
  \end{bmatrix}
 \begin{bmatrix}
    x \\
    y \\
    z \\
    1
  \end{bmatrix}
=
\begin{bmatrix}
    k_xx \\
    k_yy \\
    k_zz \\
    1
\end{bmatrix}
$$

对方向矢量可以使用同样的矩阵进行缩放：

$$
 \begin{bmatrix}
   k_x & 0 & 0 & 0 \\
   0 & k_y & 0 & 0 \\
   0 & 0 & k_z & 0 \\
   0 & 0 & 0 & 1 
  \end{bmatrix}
 \begin{bmatrix}
    x \\
    y \\
    z \\
    0
  \end{bmatrix}
=
\begin{bmatrix}
    k_xx \\
    k_yy \\
    k_zz \\
    0
\end{bmatrix}
$$

### 4.5.6　旋转矩阵

把点绕着 x 轴旋转 $\theta$ 度

$$
R_x(\theta) = 
\begin{bmatrix}
1 & 0 & 0 & 0 \\
0 & cos\theta & -sin\theta & 0 \\
0 & sin\theta & cos\theta & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

### 4.5.7　复合变换

我们约定变换的顺序就是先缩放，再旋转，最后平移。

## 4.6 坐标空间

### 4.6.3 顶点的坐标空间变换过程

### 4.6.4 模型空间

### 4.6.5 世界空间

### 4.6.6 观察空间

观察空间是一个三维空间，而屏幕空间是一个二维空间。

### 4.6.7　裁剪空间

裁剪空间的**目标**是能够方便地对渲染图元进行裁剪：
- 完全位于这块空间（**视锥体**）内部的图元将会被保留，
- 完全位于这块空间外部的图元将会被剔除，
- 而与这块空间边界相交的图元就会被裁剪。

视锥体由六个平面包围而成，这些平面也被称为裁剪平面。

### 4.6.8　屏幕空间

首先，我们需要进行标准齐次除法，也被称为透视除法。